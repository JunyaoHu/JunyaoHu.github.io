

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="胡椒">
  <meta name="keywords" content="">
  <meta name="description" content="第一关 - 逻辑回归作业 作业1：逻辑回归的表达式： A: h(x)&#x3D;wx+b B：h(x)&#x3D;wx C: h(x)&#x3D;sigmoid(wx+b) D: h(x)&#x3D;sigmoid(wx)  作业2：下面关于逻辑回归的表述是正确的(多选)： A:逻辑回归的输出结果是概率值，在0-1之间 B:使用正则化可以提高模型的泛化性 C:逻辑回归可以直接用于多分类 D:逻辑回归是无参模型 E:逻辑回归的损失函数是交">
<meta property="og:type" content="article">
<meta property="og:title" content="和鲸社区2022咸鱼打挺夏令营-机器学习原理与实践·闯关-作业答案与部分解析">
<meta property="og:url" content="http://example.com/2022/07/20/heywhale-summer-camp-ai/index.html">
<meta property="og:site_name" content="胡椒的 Coding Room">
<meta property="og:description" content="第一关 - 逻辑回归作业 作业1：逻辑回归的表达式： A: h(x)&#x3D;wx+b B：h(x)&#x3D;wx C: h(x)&#x3D;sigmoid(wx+b) D: h(x)&#x3D;sigmoid(wx)  作业2：下面关于逻辑回归的表述是正确的(多选)： A:逻辑回归的输出结果是概率值，在0-1之间 B:使用正则化可以提高模型的泛化性 C:逻辑回归可以直接用于多分类 D:逻辑回归是无参模型 E:逻辑回归的损失函数是交">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/07/20/SULNporbnwjEkOd.png">
<meta property="og:image" content="https://s2.loli.net/2022/07/21/v3JhKGwuZT45QCi.png">
<meta property="og:image" content="https://s2.loli.net/2022/07/21/A5LQj8CouqzcDMd.png">
<meta property="og:image" content="https://s2.loli.net/2022/07/21/JjfUecxAlYaG5tV.png">
<meta property="article:published_time" content="2022-07-20T01:58:17.000Z">
<meta property="article:modified_time" content="2022-07-21T12:38:46.148Z">
<meta property="article:author" content="胡椒">
<meta property="article:tag" content="机器学习">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2022/07/20/SULNporbnwjEkOd.png">
  
  <title>和鲸社区2022咸鱼打挺夏令营-机器学习原理与实践·闯关-作业答案与部分解析 - 胡椒的 Coding Room</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":17340920,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>胡椒的 Coding Room</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.1)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="和鲸社区2022咸鱼打挺夏令营-机器学习原理与实践·闯关-作业答案与部分解析">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-07-20 09:58" pubdate>
        2022年7月20日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      25k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      79 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">和鲸社区2022咸鱼打挺夏令营-机器学习原理与实践·闯关-作业答案与部分解析</h1>
            
            <div class="markdown-body">
              <h1 id="第一关-逻辑回归"><a href="#第一关-逻辑回归" class="headerlink" title="第一关 - 逻辑回归"></a>第一关 - 逻辑回归</h1><h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ul>
<li><p>作业1：逻辑回归的表达式：</p>
<p>A: h(x)=wx+b</p>
<p>B：h(x)=wx</p>
<p>C: h(x)=sigmoid(wx+b)</p>
<p>D: h(x)=sigmoid(wx)</p>
</li>
<li><p>作业2：下面关于逻辑回归的表述是正确的(多选)：</p>
<p>A:逻辑回归的输出结果是概率值，在0-1之间</p>
<p>B:使用正则化可以提高模型的泛化性</p>
<p>C:逻辑回归可以直接用于多分类</p>
<p>D:逻辑回归是无参模型</p>
<p>E:逻辑回归的损失函数是交叉熵</p>
</li>
<li><p>作业3：计算 $y=sigmoid(w_1<em>x_1+w_2</em>x_2+1)$ 当 w=(0.2, 0.3)时，样本X=(1,1),y=1的时w1,w2的梯度和loss：(保存3位小数，四舍五入)</p>
</li>
<li><p>作业4：在cal_grad梯度函数的基础上加上L2正则化，下面的函数是否正确?(Y/N)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cal_grad</span>(<span class="hljs-params">y, t,x,w</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    x:输入X</span><br><span class="hljs-string">    y:样本y</span><br><span class="hljs-string">    t:预测t</span><br><span class="hljs-string">    w:参数w</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    grad = np.<span class="hljs-built_in">sum</span>(t - y) / t.shape[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">return</span> grad*x+<span class="hljs-number">2</span>*w<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">C</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">ABE</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">-0.182</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">a4</td>
<td style="text-align:center">-0.182</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">a5</td>
<td style="text-align:center">0.201</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">a6</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>t1代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sigmoid</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + np.exp(-x))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cal_grad</span>(<span class="hljs-params">y, t</span>):</span><br>    grad = np.<span class="hljs-built_in">sum</span>(t - y) / t.shape[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">return</span> grad<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cal_cross_loss</span>(<span class="hljs-params">y, t</span>):</span><br>    loss=np.<span class="hljs-built_in">sum</span>(-y * np.log(t)- (<span class="hljs-number">1</span> - y) * np.log(<span class="hljs-number">1</span> - t))/t.shape[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">return</span> loss<br>    <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">linearRegression</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>([x[i]*w[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x))])+b<br>linearRegression([<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>])<br><br>w=[<span class="hljs-number">0.2</span>,<span class="hljs-number">0.3</span>]<br>b=<span class="hljs-number">1</span><br>    <br>linearRegression([<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>])<br>sigmoid(linearRegression([<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>])<br>cal_grad(<span class="hljs-number">1</span>,sigmoid(linearRegression([<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>])))<br></code></pre></td></tr></table></figure>
<h1 id="第二关-朴素贝叶斯法"><a href="#第二关-朴素贝叶斯法" class="headerlink" title="第二关 - 朴素贝叶斯法"></a>第二关 - 朴素贝叶斯法</h1><h2 id="作业-1"><a href="#作业-1" class="headerlink" title="作业"></a>作业</h2><ul>
<li><p>1:假设A,B两个盒子球有无限个，已知从A盒子摸出红球和白球的概率为0.7和0.3，从B盒子中摸出的红球和白球的概率为0.5和0.5。从某一个盒子中摸了3次球，颜色依次为白，白，红。问是从A盒子中摸得的概率是多少？(保留4位小数)</p>
</li>
<li><p>2:贝叶斯推断最重要的假设是什么？</p>
<p>A：独立性假设</p>
<p>B：参数服从一个分布</p>
</li>
<li><p>3:贝叶斯估计与最大似然估计的区别是：(Y/N)</p>
<p>贝叶斯假设参数服从一个分布,不是一个确定的值，而最大似然估计认为参数是一个值。</p>
</li>
<li><p>4:假设训练数据：确定 x=(2,S) 的结果，求出y的预测结果</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-symbol">X</span>=[[<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>],[<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>],[<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>],[<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>],[<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>],\<br>   [<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>],[<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>],[<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>],[<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>],[<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>],\<br>   [<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>],[<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>],[<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>],[<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>],[<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>]]<br><span class="hljs-symbol">Y</span>=[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure>
</li>
<li><p>5:第四题中，当使用拉普拉斯平滑，即λ=1，求y的预测结果</p>
</li>
</ul>
<h2 id="答案-1"><a href="#答案-1" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">0.3351</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">A</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">a4</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">a5</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析-1"><a href="#解析-1" class="headerlink" title="解析"></a>解析</h2><p>t1解法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">p（1|白白红）= p（白白红，1）/p（白白红）<br>           = p（白白红|1）*p（1）/=（p（白白红|1）*p（1）+p（白白红|2）*p（2））<br>           = 0.3<span class="hljs-number">*0</span>.3<span class="hljs-number">*0</span>.7<span class="hljs-number">*0</span>.5/（0.3<span class="hljs-number">*0</span>.3<span class="hljs-number">*0</span>.7<span class="hljs-number">*0</span>.5+0.5<span class="hljs-number">*0</span>.5<span class="hljs-number">*0</span>.5<span class="hljs-number">*0</span>.5）<br>           = 0.335106383						<br></code></pre></td></tr></table></figure>
<p>t4解法：看统计学习方法，原题</p>
<p>题目讲解来源：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1No4y1o7ac?p=28">【合集】十分钟 机器学习 系列视频 《统计学习方法》</a></p>
<p><img src="https://s2.loli.net/2022/07/20/SULNporbnwjEkOd.png" srcset="/img/loading.gif" lazyload alt="image.png" style="zoom: 67%;" /></p>
<p>t5看公式</p>
<script type="math/tex; mode=display">
P(Y=c_k)=\frac{\sum_{i=1}^K{I(y_i=c_k)+\lambda}}{N+K\lambda}</script><p>当$\lambda$等于1的时候，称之为拉普拉斯平滑。</p>
<p>p（y=1）=（9+1）/（15+2）</p>
<p>p（y=0）=（6+1）/（15+2）</p>
<h1 id="第三关-K近邻算法"><a href="#第三关-K近邻算法" class="headerlink" title="第三关 - K近邻算法"></a>第三关 - K近邻算法</h1><h2 id="作业-2"><a href="#作业-2" class="headerlink" title="作业"></a>作业</h2><ul>
<li><p>1：请你回顾下KNN算法的三要素：</p>
</li>
<li><p>2：改写一下函数使其可以应用于KNN的回归预测,回归预测的loss为平方差</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span>(<span class="hljs-params">self, train_x, y, test, k</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    返回根据KNN预测的结果</span><br><span class="hljs-string">    :param train_x: 训练集x</span><br><span class="hljs-string">    :param y: 训练集y</span><br><span class="hljs-string">    :param test: 预测集</span><br><span class="hljs-string">    :return: 返回test预测的结果</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    dis = self.euclidean_dis(test, train_x)<br>    k_neighbor = np.argsort(dis, axis=<span class="hljs-number">1</span>)[:, :k]<br>    k_neighbor_value = y[k_neighbor]<br>    n = test.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 预测结果的个数</span><br>    pred = np.zeros(n)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        pred[i] = np.argmax(np.bincount(k_neighbor_value[i])) <span class="hljs-comment">##改写1</span><br>    <span class="hljs-keyword">return</span> pred<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">KFlod</span>(<span class="hljs-params">self, k</span>):</span><br>    folds = StratifiedKFold(n_splits=<span class="hljs-number">5</span>, shuffle=<span class="hljs-literal">True</span>, random_state=<span class="hljs-number">1996</span>)<br>    oof = np.zeros(self.train_x.shape[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">for</span> fold_, (train_index, test_index) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(folds.split(self.train_x, self.train_y)):<br>        train_x, test_x, train_y, test_y = self.train_x[train_index], self.train_x[test_index], \<br>                                           self.train_y[<br>                                               train_index], self.train_y[test_index]<br>        pred = self.predict(train_x, train_y, test_x, k)<br>        oof[test_index] = pred<br>    <span class="hljs-keyword">return</span> np.<span class="hljs-built_in">sum</span>(oof == self.train_y)                     <span class="hljs-comment">#改写2</span><br></code></pre></td></tr></table></figure>
<p>下面那个改写是正确的：</p>
<p>A：pred[i]=np.sum(k_neighbor_value[i]),np.sum(oof - self.train_y)</p>
<p>B: pred[i]=np.mean(k_neighbor_value[i]),np.sum(oof - self.train_y)</p>
<p>C：pred[i]=np.sum(k_neighbor_value[i]),np.sum((oof - self.train_y)**2)</p>
<p>D: pred[i]=np.mean(k_neighbor_value[i]),np.sum((oof - self.train_y)**2)</p>
</li>
<li><p>3:使用全部iris数据，选取中最优的K值，并且计算此时分类正确的个数</p>
</li>
</ul>
<h2 id="答案-2"><a href="#答案-2" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">K值</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">度量距离</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">决策规则</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">a4</td>
<td style="text-align:center">D</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">a5</td>
<td style="text-align:center">13</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">a6</td>
<td style="text-align:center">146</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析-2"><a href="#解析-2" class="headerlink" title="解析"></a>解析</h2><p>t3代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> datasets<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> StratifiedKFold<br><br>X = datasets.load_iris()[<span class="hljs-string">&#x27;data&#x27;</span>]<br>Y = datasets.load_iris()[<span class="hljs-string">&#x27;target&#x27;</span>]<br>X_train, X_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="hljs-number">0.4</span>, stratify=Y,random_state=<span class="hljs-number">100</span>)<br>X_test = datasets.load_iris()[<span class="hljs-string">&#x27;data&#x27;</span>]<br>y_test = datasets.load_iris()[<span class="hljs-string">&#x27;target&#x27;</span>]<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KNN</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, train_x, train_y, test_x, test_y</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        KNN初始话</span><br><span class="hljs-string">        :param train_x:训练集X</span><br><span class="hljs-string">        :param train_y: 训练集Y</span><br><span class="hljs-string">        :param test_x: 预测集X</span><br><span class="hljs-string">        :param test_y: 预测集Y</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        self.train_x = train_x<br>        self.train_y = train_y<br>        self.test_x = test_x<br>        self.test_y = test_y<br>        self.k = <span class="hljs-literal">None</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">euclidean_dis</span>(<span class="hljs-params">self, x1, x2</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        返回x1与x2的距离(x1,x2均为二维矩阵).x1.shape=(N1*M),x2.shape=(N2*M2),返回结果为(N1*N2)</span><br><span class="hljs-string">        :param x1:</span><br><span class="hljs-string">        :param x2:</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        n1, m1 = x1.shape<br>        n2, m2 = x2.shape<br>        <span class="hljs-keyword">if</span> m1 != m2:<br>            <span class="hljs-keyword">raise</span> (<span class="hljs-string">&quot;两个向量维度不相等&quot;</span>)<br>        x1x2 = np.dot(x1, x2.T)  <span class="hljs-comment"># (n1,n2)</span><br>        y1 = np.repeat(np.reshape(np.<span class="hljs-built_in">sum</span>(np.multiply(x1, x1), axis=<span class="hljs-number">1</span>), (n1, <span class="hljs-number">1</span>)), repeats=n2, axis=<span class="hljs-number">1</span>)<br>        y2 = np.repeat(np.reshape(np.<span class="hljs-built_in">sum</span>(np.multiply(x2, x2), axis=<span class="hljs-number">1</span>), (n2, <span class="hljs-number">1</span>)), repeats=n1, axis=<span class="hljs-number">1</span>).T<br>        dis = y1 + y2 - <span class="hljs-number">2</span> * x1x2<br>        <span class="hljs-keyword">return</span> dis<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span>(<span class="hljs-params">self, train_x, y, test, k</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        返回根据KNN预测的结果</span><br><span class="hljs-string">        :param train_x: 训练集x</span><br><span class="hljs-string">        :param y: 训练集y</span><br><span class="hljs-string">        :param test: 预测集</span><br><span class="hljs-string">        :return: 返回test预测的结果</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        dis = self.euclidean_dis(test, train_x)<br>        k_neighbor = np.argsort(dis, axis=<span class="hljs-number">1</span>)[:, :k]<br>        k_neighbor_value = y[k_neighbor]<br>        n = test.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 预测结果的个数</span><br>        pred = np.zeros(n)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            pred[i] = np.argmax(np.bincount(k_neighbor_value[i]))<br>        <span class="hljs-keyword">return</span> pred<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">KFlod</span>(<span class="hljs-params">self, k</span>):</span><br>        folds = StratifiedKFold(n_splits=<span class="hljs-number">5</span>, shuffle=<span class="hljs-literal">True</span>, random_state=<span class="hljs-number">1996</span>)<br>        oof = np.zeros(self.train_x.shape[<span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">for</span> fold_, (train_index, test_index) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(folds.split(self.train_x, self.train_y)):<br>            train_x, test_x, train_y, test_y = self.train_x[train_index], self.train_x[test_index], \<br>                                               self.train_y[<br>                                                   train_index], self.train_y[test_index]<br>            pred = self.predict(train_x, train_y, test_x, k)<br>            oof[test_index] = pred<br>        <span class="hljs-keyword">return</span> np.<span class="hljs-built_in">sum</span>(oof == self.train_y)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">selectK</span>(<span class="hljs-params">self</span>):</span><br>        ks = [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>]<br>        value = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> ks:<br>            value_tem = self.KFlod(k)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;当前K的值为：&quot;</span>, k, <span class="hljs-string">&quot;预测得分为：&quot;</span>, value_tem)<br>            <span class="hljs-keyword">if</span> value_tem &gt; value:<br>                self.k = k<br>                value = value_tem<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trainAndPredic</span>(<span class="hljs-params">self</span>):</span><br>        self.selectK()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;选择的k为：&quot;</span>, self.k)<br>        preds = self.predict(self.train_x, self.train_y, self.test_x, self.k)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;预测结果的正确个数为:&quot;</span>, np.<span class="hljs-built_in">sum</span>(preds == self.test_y))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;预测结果的错误个数为:&quot;</span>, np.<span class="hljs-built_in">sum</span>(preds != self.test_y))<br><br><br>model = KNN(X_train, y_train, X_test, y_test)<br>model.trainAndPredic()<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">当前K的值为： 2 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 3 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 4 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 5 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 6 预测得分为： 88</span><br><span class="hljs-string">当前K的值为： 7 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 8 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 9 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 10 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 11 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 12 预测得分为： 89</span><br><span class="hljs-string">当前K的值为： 13 预测得分为： 90</span><br><span class="hljs-string">当前K的值为： 14 预测得分为： 88</span><br><span class="hljs-string">当前K的值为： 15 预测得分为： 89</span><br><span class="hljs-string">选择的k为： 13</span><br><span class="hljs-string">预测结果的正确个数为: 146</span><br><span class="hljs-string">预测结果的错误个数为: 4</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<h1 id="第四关-K-means算法"><a href="#第四关-K-means算法" class="headerlink" title="第四关 - K-means算法"></a>第四关 - K-means算法</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>数据准备</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-title">from</span> sklearn <span class="hljs-keyword">import</span> datasets<br><span class="hljs-title">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-type">X</span>=datasets.load_iris()[&#x27;<span class="hljs-class"><span class="hljs-keyword">data</span>&#x27;]</span><br><span class="hljs-type">Y</span>=datasets.load_iris()[&#x27;target&#x27;]<br></code></pre></td></tr></table></figure>
<ul>
<li>1.对样本X进行归一化(均值方差归一化)，输出并且将归一化的结果的第一行(<strong>将输出的list转化为string,用逗号(,)连接，四舍五入保留3位小数，注意不能有空格</strong>)</li>
<li>2:计算上一步<strong>归一化之后</strong>样本中第一个样本与最后一个样本的欧式距离（四舍五入3位小数）。</li>
<li>3：根据数据中已有的类别(Y就是类别)，分别计算类别0，类别1，类别2的中心点(不归一化)：(<strong>将输出的list转化为string,用逗号(,)连接，四舍五入保留1位小数，不能有空格</strong>)</li>
</ul>
<h2 id="答案-3"><a href="#答案-3" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">-0.901,1.019,-1.340,-1.315</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">3.335</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">5.0,3.4,1.5,0.2</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">a4</td>
<td style="text-align:center">5.9,2.8,4.3,1.3</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">a5</td>
<td style="text-align:center">6.6,3.0,5.6,2.0</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析-3"><a href="#解析-3" class="headerlink" title="解析"></a>解析</h2><p>题目1</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">x_mean = <span class="hljs-built_in">np</span>.<span class="hljs-built_in">mean</span>(X, axis=<span class="hljs-number">0</span>)<br><span class="hljs-built_in">length</span> = len(X)<br>x_std =  <span class="hljs-built_in">sum</span>((X-x_mean)**<span class="hljs-number">2</span>)/<span class="hljs-built_in">length</span><br>X1 = (X-x_mean)/<span class="hljs-built_in">np</span>.<span class="hljs-built_in">sqrt</span>(x_std)<br>X1[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure>
<p>题目2</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">np</span>.sqrt(sum((X<span class="hljs-number">1</span>[<span class="hljs-number">0</span>]-X<span class="hljs-number">1</span>[-<span class="hljs-number">1</span>])**<span class="hljs-number">2</span>))<br></code></pre></td></tr></table></figure>
<p>题目3（不要看错题目认为是根据kmeans计算得到聚类中心点，而是根据已有标签计算中心点）</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pos = []<br>pos.append(np.mean(X[<span class="hljs-attribute">Y</span>==0],<span class="hljs-attribute">axis</span>=0))<br>pos.append(np.mean(X[<span class="hljs-attribute">Y</span>==1],<span class="hljs-attribute">axis</span>=0))<br>pos.append(np.mean(X[<span class="hljs-attribute">Y</span>==2],<span class="hljs-attribute">axis</span>=0))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> pos:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> i:<br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;&#123;:.1f&#125;&#x27;</span>.format(j),<span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27;,&#x27;</span>)<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure>
<h1 id="第五关-线性判别器LDA"><a href="#第五关-线性判别器LDA" class="headerlink" title="第五关 - 线性判别器LDA"></a>第五关 - 线性判别器LDA</h1><h2 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h2><ul>
<li><p>1：在2.2(扩展到多分类)中说到，”两种计算方式的结果是成比例的”，请你计算一下使用我们代码中计算方法和采用另外一种方法计算两者之间的比例。$S<em>B1$为我给出代码中的计算方法，$S_B2$为$S_b=\sum</em>{i,j|i\neq j}[(u_i-u_j)(u_i-u_j)^T]$，直接给出$S_B1$与$S_B2$之间的比例。</p>
</li>
<li><p>2：下面关于线性判别器的理解正确的是？（不定项）</p>
<p>A：线性判别器是一个分类器</p>
<p>B：线性判别器是一个无监督模型</p>
<p>C:线性判别器是一个降维方法</p>
<p>D:线性判别器可以降低至任意维度</p>
</li>
</ul>
<h2 id="答案-4"><a href="#答案-4" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">8.33</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">C</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析-4"><a href="#解析-4" class="headerlink" title="解析"></a>解析</h2><p>t1代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> datasets<br><br><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_blobs<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><br>X = datasets.load_iris()[<span class="hljs-string">&#x27;data&#x27;</span>]<br>Y = datasets.load_iris()[<span class="hljs-string">&#x27;target&#x27;</span>]<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LDA</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, k_after</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        x:         样本x</span><br><span class="hljs-string">        y:         样本y</span><br><span class="hljs-string">        n_i：      第i类样本的个数</span><br><span class="hljs-string">        u_i：      第i类样本均值,格式为&#123;i:[]&#125;</span><br><span class="hljs-string">        n_label：  样本的类别</span><br><span class="hljs-string">        k_after:   降维后的维度</span><br><span class="hljs-string">        k_before:  降维前的维度]</span><br><span class="hljs-string">        labels:    不同的类别，比如[1,2,3]</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        self.n_i = &#123;&#125;<br>        self.u_i = &#123;&#125;<br>        self.k_after = k_after<br>        self.k_before = X.shape[<span class="hljs-number">0</span>]<br>        self.labels = <span class="hljs-literal">None</span><br>        self.sigmas = &#123;&#125;<br>        self.S = <span class="hljs-literal">None</span>  <span class="hljs-comment"># S_w</span><br>        self.B = <span class="hljs-literal">None</span>  <span class="hljs-comment"># S_b</span><br>        self.w = <span class="hljs-literal">None</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit</span>(<span class="hljs-params">self, X, y</span>):</span><br>        self.n = <span class="hljs-built_in">len</span>(np.unique(y))<br>        self.n_label = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(y))<br>        labels = np.unique(y)<br>        self.labels = labels<br>        N = X.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 样本的个数</span><br>        means = []<br><br>        <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> labels:<br>            tmp = np.mean(X[y == label], axis=<span class="hljs-number">0</span>)  <span class="hljs-comment">##第i类的平均u_i</span><br><br>            means.append(tmp)<br>            self.u_i[label] = tmp  <span class="hljs-comment">##记录第i类样本的均值</span><br>            self.n_i[label] = <span class="hljs-built_in">len</span>(X[y == label])   <span class="hljs-comment">#记录第i类样本的个数</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(labels) == <span class="hljs-number">2</span>:<br>            tmp = (means[<span class="hljs-number">0</span>] - means[<span class="hljs-number">1</span>])<br>            tmp = tmp.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)  <span class="hljs-comment"># 转化为(k_before,1)维度的列向量</span><br>            B = np.dot(tmp, tmp.T)  <span class="hljs-comment"># (u[0]-u[1])(u[0]-u[1])^T</span><br>        <span class="hljs-keyword">else</span>:<br>            mean_all = np.mean(X, axis=<span class="hljs-number">0</span>)<br>            B = np.zeros((X.shape[<span class="hljs-number">1</span>], X.shape[<span class="hljs-number">1</span>]))<br>            <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> self.u_i:<br>                n_i = self.n_i[label]<br>                tmp = self.u_i[label] - mean_all<br>                tmp = tmp.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>                B += n_i * np.dot(tmp, tmp.T)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Sb1=&#x27;</span>,B)<br><br>            Sb2 = np.zeros((X.shape[<span class="hljs-number">1</span>], X.shape[<span class="hljs-number">1</span>]))<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.u_i)):<br>                <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.u_i)):<br>                    <span class="hljs-keyword">if</span> i != j:<br>                        tmp = self.u_i[i] - self.u_i[j]<br>                        tmp = tmp.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>                        Sb2 += np.dot(tmp, tmp.T)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Sb2=&#x27;</span>,Sb2)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Sb1/Sb2=&#x27;</span>,B/Sb2)<br><br>        S = np.zeros((X.shape[<span class="hljs-number">1</span>], X.shape[<span class="hljs-number">1</span>]))<br>        <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> self.u_i:<br>            u_i = self.u_i[label]<br>            <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> X[y == label]:<br>                tmp = (row - u_i)<br>                tmp = tmp.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>                S += np.dot(tmp, tmp.T)<br>        self.S = S<br>        <br><br><br>        <br><br>        S_inv = np.linalg.inv(S)  <span class="hljs-comment"># 矩阵S_w的逆</span><br>        S_inv_B = S_inv @ B  <span class="hljs-comment"># S_w*B</span><br>        diag, p = np.linalg.eig(S_inv_B)  <span class="hljs-comment">## 特征值，特征向量</span><br><br>        ind = diag.argsort()[::-<span class="hljs-number">1</span>]  <span class="hljs-comment">##按照特征值大小排序</span><br>        diag = diag[ind]<br>        w = p[:, ind]  <span class="hljs-comment"># 按照特征值大小将特征向量排序</span><br>        self.w = w[:, :self.k_after]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span>(<span class="hljs-params">self, x</span>):</span><br>        x = np.asarray(x)<br>        <span class="hljs-keyword">return</span> np.dot(x, self.w)<br><br><br>model = LDA(<span class="hljs-number">2</span>)<br>model.fit(X, Y)<br>X2=model.predict(X)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Sb1= [[ 63.21213333 -19.95266667 165.2484      71.27933333]</span><br><span class="hljs-string"> [-19.95266667  11.34493333 -57.2396     -22.93266667]</span><br><span class="hljs-string"> [165.2484     -57.2396     437.1028     186.774     ]</span><br><span class="hljs-string"> [ 71.27933333 -22.93266667 186.774       80.41333333]]</span><br><span class="hljs-string"> </span><br><span class="hljs-string">Sb2= [[ 7.585456 -2.39432  19.829808  8.55352 ]</span><br><span class="hljs-string"> [-2.39432   1.361392 -6.868752 -2.75192 ]</span><br><span class="hljs-string"> [19.829808 -6.868752 52.452336 22.41288 ]</span><br><span class="hljs-string"> [ 8.55352  -2.75192  22.41288   9.6496  ]]</span><br><span class="hljs-string"> </span><br><span class="hljs-string">Sb1/Sb2= [[8.33333333 8.33333333 8.33333333 8.33333333]</span><br><span class="hljs-string"> [8.33333333 8.33333333 8.33333333 8.33333333]</span><br><span class="hljs-string"> [8.33333333 8.33333333 8.33333333 8.33333333]</span><br><span class="hljs-string"> [8.33333333 8.33333333 8.33333333 8.33333333]]</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<h1 id="第六关-支持向量机"><a href="#第六关-支持向量机" class="headerlink" title="第六关 - 支持向量机"></a>第六关 - 支持向量机</h1><h2 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h2><ul>
<li><p>1：下面逻辑回归与支持向量机的对比正确的是：（多选，注意大写）</p>
<p>A：逻辑回归速度比SVM更快</p>
<p>B：SVM和逻辑回归一样，任何样本都会对最终情况产生影响</p>
<p>C：都不能<strong>直接</strong>进行多分类</p>
<p>D：逻辑回归输出概率，SVM直接输出类别</p>
<p>E：两者的目标函数不同，逻辑回归是交叉熵，SVM是Hinge Loss</p>
</li>
<li><p>2：关于选取最大分离面下面说法是否正确？(Y/N)</p>
<p>回答：理论上来说，分离超平面有无数个，但是最大分离面只有一个。此外，使用最大间隔分离面对未知的样本有更好的泛化能力。</p>
</li>
<li><p>3：下面关于核函数的介绍正确的是？（多选，注意大写）</p>
<p>A：提升SVM的非线性拟合能力</p>
<p>B：可以提升SVM模型的准确度</p>
<p>C：能够使得模型训练速度变快</p>
<p>D：降低模型过拟合的风险</p>
</li>
</ul>
<h2 id="答案-5"><a href="#答案-5" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">ACDE</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">AB</td>
</tr>
</tbody>
</table>
</div>
<h1 id="第七关-决策树"><a href="#第七关-决策树" class="headerlink" title="第七关 - 决策树"></a>第七关 - 决策树</h1><h2 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h2><ul>
<li><p>1：写出文中介绍的三种分类算法(按照介绍的顺序)</p>
</li>
<li><p>2：计算下面数据的熵与Gini指数（保留3位小数，四舍五入）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br>data_path=<span class="hljs-string">r&quot;/home/mw/input/data2794&quot;</span><br>data = pd.read_csv(<span class="hljs-string">r&quot;/home/mw/input/data2794/西瓜数据集.csv&quot;</span>)    <br></code></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="答案-6"><a href="#答案-6" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">信息增益</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">信息增益比</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">Gini指数</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">a4</td>
<td style="text-align:center">0.998</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">a5</td>
<td style="text-align:center">0.498</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析-5"><a href="#解析-5" class="headerlink" title="解析"></a>解析</h2><p>t2代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> log<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">calShanEnt</span>(<span class="hljs-params">dataset,col</span>):</span><br>    tarset=<span class="hljs-built_in">set</span>(dataset[col])<br>    res=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tarset:<br>        pi=np.<span class="hljs-built_in">sum</span>(dataset[col] == i)/<span class="hljs-built_in">len</span>(dataset)<br>        res=res-pi* log(pi, <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> res<br><br>calShanEnt(data,<span class="hljs-string">&quot;target&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Gini</span>(<span class="hljs-params">dataset,col</span>):</span><br>    tarset = <span class="hljs-built_in">set</span>(dataset[col])<br>    gini=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tarset:<br>        gini=gini-(np.<span class="hljs-built_in">sum</span>(dataset[col] == i)/<span class="hljs-built_in">len</span>(dataset))**<span class="hljs-number">2</span><br>    <span class="hljs-keyword">return</span> gini<br><br>Gini(data,<span class="hljs-string">&quot;target&quot;</span>)<br></code></pre></td></tr></table></figure>
<h1 id="第八关-基于xgboost的分类预测"><a href="#第八关-基于xgboost的分类预测" class="headerlink" title="第八关 - 基于xgboost的分类预测"></a>第八关 - 基于xgboost的分类预测</h1><h2 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h2><ul>
<li><p>1：xgb与GBDT在损失函数上的区别(多选)</p>
<p>A：正则化</p>
<p>B：二阶残差</p>
<p>C：一阶残差</p>
</li>
<li><p>2：计算函数 f=x3+x2 在x=0.5处的二阶梯度</p>
</li>
<li><p>3：下面哪些方式可以提升xgb模型的准确度（多选）</p>
<p>A：更多的数据</p>
<p>B：更好的特征工程</p>
<p>C：减少树的深度</p>
<p>D：增加学习率</p>
</li>
<li><p>4：令x=x_train[:1]，使用上面的sklearn包装的xgb模型预测x所对应得target值(输出target为1概率，保留4位小数)</p>
</li>
</ul>
<h2 id="答案-7"><a href="#答案-7" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">AB</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">5</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">ABCD</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">a4</td>
<td style="text-align:center">0.0307</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析-6"><a href="#解析-6" class="headerlink" title="解析"></a>解析</h2><p>t4代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> datasets<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br>X=datasets.load_breast_cancer()[<span class="hljs-string">&#x27;data&#x27;</span>]<br>Y=datasets.load_breast_cancer()[<span class="hljs-string">&#x27;target&#x27;</span>]<br>fea=datasets.load_breast_cancer()[<span class="hljs-string">&#x27;feature_names&#x27;</span>]<br><br>data=pd.DataFrame(X,columns=fea)<br>data[<span class="hljs-string">&#x27;target&#x27;</span>]=Y<br>x_train=data[fea]<br>y_train=data[<span class="hljs-string">&#x27;target&#x27;</span>]<br>data[<span class="hljs-string">&#x27;target&#x27;</span>].value_counts()<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> KFold,StratifiedKFold<br><span class="hljs-keyword">import</span> xgboost <span class="hljs-keyword">as</span> xgb<br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> sklearn<br>folds = KFold(n_splits=<span class="hljs-number">5</span>, shuffle=<span class="hljs-literal">True</span>, random_state=<span class="hljs-number">1996</span>)<br>params = &#123;<br>    <span class="hljs-string">&#x27;learning_rate&#x27;</span>: <span class="hljs-number">0.05</span>,<br>    <span class="hljs-string">&#x27;max_depth&#x27;</span>: <span class="hljs-number">8</span>,  <br>    <span class="hljs-string">&#x27;eval_metric&#x27;</span>: <span class="hljs-string">&#x27;auc&#x27;</span>,<br>    <span class="hljs-string">&#x27;objective&#x27;</span>: <span class="hljs-string">&#x27;binary:logistic&#x27;</span>,<br>&#125;<br><span class="hljs-keyword">import</span> warnings <br>warnings.filterwarnings(<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>oof=np.zeros(x_train.shape[<span class="hljs-number">0</span>]) <br><span class="hljs-keyword">for</span> fold_, (train_index, test_index) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(folds.split(x_train, y_train)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第&#123;&#125;折&quot;</span>.<span class="hljs-built_in">format</span>(fold_))<br>    <br>    train_x, test_x, train_y, test_y = x_train.iloc[train_index], x_train.iloc[test_index], y_train.iloc[train_index], y_train.iloc[test_index]   <br><br>    model=xgb.XGBClassifier(objective=<span class="hljs-string">&quot;binary:logistic&quot;</span>,booster=<span class="hljs-string">&quot;gbtree&quot;</span><br>                ,max_depth=<span class="hljs-number">6</span>, learning_rate=<span class="hljs-number">0.05</span>, n_estimators=<span class="hljs-number">1000</span>,<br>                  n_jobs=<span class="hljs-number">1</span>, gamma=<span class="hljs-number">1</span>,<br><span class="hljs-comment">#                  min_child_weight=1, subsample=0.9,</span><br><span class="hljs-comment">#                  colsample_bytree=0.9, </span><br><span class="hljs-comment">#                  colsample_bynode=0.85, reg_alpha=1, reg_lambda=1,</span><br>                 scale_pos_weight=<span class="hljs-number">5</span>, random_state=<span class="hljs-number">2022</span>)<br>    model.fit(train_x,train_y,sample_weight=<span class="hljs-literal">None</span>,eval_set=[(train_x,train_y),(test_x,test_y)],eval_metric=<span class="hljs-string">&quot;auc&quot;</span>,early_stopping_rounds=<span class="hljs-number">50</span>,verbose=<span class="hljs-number">20</span>,)<br>    val_train=model.predict_proba(test_x)[:,<span class="hljs-number">1</span>]<br>    oof[test_index]=val_train<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;最终auc为：&quot;</span>,sklearn.metrics.roc_auc_score(y_train,oof))<br><br>x=x_train[:<span class="hljs-number">1</span>]<br>model.predict_proba(x)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">...</span><br><span class="hljs-string">最终auc为： 0.9810461920617303</span><br><span class="hljs-string">array([[0.9692602 , 0.03073976]], dtype=float32)</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<h1 id="关卡9-基于LightGBM的数据实践"><a href="#关卡9-基于LightGBM的数据实践" class="headerlink" title="关卡9 基于LightGBM的数据实践"></a><strong>关卡9 基于LightGBM的数据实践</strong></h1><ul>
<li><p>1：下面哪些是lgb相对于xgb的优化点？</p>
<p>A：使用了二阶残差</p>
<p>B：使用了直方图进行加速计算</p>
<p>C：可以支持类别特征处理</p>
<p>D：使用了单边梯度采样减少计算样本</p>
<p>E：使用了互斥捆绑算法进行特征组合减少了特征数量</p>
<p>F：使用了带深度限制的 Leaf-wise 算法避免了无效的树生长</p>
</li>
<li><p>2：假设叶节点的数量相同，xgb的深度一定会比lgb的深度大？(Y/N)</p>
</li>
<li><p>3：下面关于lgb与随机森林的说法正确的是（多选）？</p>
<p>A：lgb和随机森林都是由多颗决策树组成</p>
<p>B：Lgb和随机森林的树都是可以并行生成的</p>
<p>C：随机森林的决策树可以是回归树也可以是分类树，lgb只能是回归树</p>
<p>D：随机森林主要是通过减低方差提高模型的泛化能力，lgb是降低偏差提高模型的拟合能力</p>
</li>
</ul>
<h2 id="答案-8"><a href="#答案-8" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">BCDEF</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">N</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">ACD</td>
</tr>
</tbody>
</table>
</div>
<h1 id="关卡10-BP神经网络"><a href="#关卡10-BP神经网络" class="headerlink" title="关卡10 BP神经网络"></a><strong>关卡10 BP神经网络</strong></h1><h2 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h2><ul>
<li><p>1：BP神经网络过拟合时可以通过哪些方法来改进</p>
<p>A：减少网络深度</p>
<p>B：减少神经元的数量</p>
<p>C：增加dropout</p>
<p>D：增加数据量</p>
</li>
<li><p>2：当进行回归预测时，计算输出层的loss和回传梯度</p>
<p>t=np.array([[0.00324988]<br>[0.01669568]<br>[0.01676606]<br>[0.97652019]])</p>
<p>y=np.array([[0],[0],[0],[1]])</p>
<p>提交结果格式为：0.3,0.2,0.2,0.4,0.5<br>前四个数字为梯度，第五个为loss，<strong>保留5位小数(四舍五入，请注意不要有空格)</strong></p>
</li>
<li><p>以上面的神经网络为例，请问一下总共的参数数量为多少？答案为整数</p>
</li>
<li><p>使用上面的神经网络预测test=[[0.3,0.4],[1,2]]的类别。输出结果为(两个结果直接相连，比如提交01，11，10等)</p>
</li>
</ul>
<h2 id="答案-9"><a href="#答案-9" class="headerlink" title="答案"></a>答案</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">id</th>
<th style="text-align:center">answer</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">a1</td>
<td style="text-align:center">ABCD</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">a2</td>
<td style="text-align:center">0.00325,0.01670,0.01677,-0.02348,0.01519</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">a3</td>
<td style="text-align:center">17</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">a4</td>
<td style="text-align:center">01</td>
</tr>
</tbody>
</table>
</div>
<h2 id="解析-7"><a href="#解析-7" class="headerlink" title="解析"></a>解析</h2><p>t2代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cal_grad</span>(<span class="hljs-params">y, t</span>):</span><br>    grad = t - y<br>    <span class="hljs-keyword">return</span> grad<br><br>t=np.array([[<span class="hljs-number">0.00324988</span>],[<span class="hljs-number">0.01669568</span>],[<span class="hljs-number">0.01676606</span>],[<span class="hljs-number">0.97652019</span>]])<br>y=np.array([[<span class="hljs-number">0</span>],[<span class="hljs-number">0</span>],[<span class="hljs-number">0</span>],[<span class="hljs-number">1</span>]])<br>cal_grad(y,t)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">array([[ 0.00324988],</span><br><span class="hljs-string">       [ 0.01669568],</span><br><span class="hljs-string">       [ 0.01676606],</span><br><span class="hljs-string">       [-0.02347981]])</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cal_cross_loss</span>(<span class="hljs-params">y, t</span>):</span><br>    loss=np.<span class="hljs-built_in">sum</span>(-y * np.log(t)- (<span class="hljs-number">1</span> - y) * np.log(<span class="hljs-number">1</span> - t))/t.shape[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">return</span> loss<br><br><br>cal_cross_loss(y,t)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">0.015189962638228426</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<p>t3</p>
<p>包括w和b</p>
<p>一层2-&gt;4  2*4+4=12</p>
<p>一层4-&gt;1  4*1+1=5</p>
<p>12+5=17个</p>
<p>t4代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>X = np.array([[<span class="hljs-number">0.3</span>,<span class="hljs-number">0.4</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]])<br>y=np.array([[<span class="hljs-number">0</span>],[<span class="hljs-number">1</span>]])<br>net=Net()<br>net.__init__(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0.1</span>)<br>net.trian(X,y)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[[0.3 0.4]</span><br><span class="hljs-string"> [1.  2. ]]</span><br><span class="hljs-string">[[0]</span><br><span class="hljs-string"> [1]]</span><br><span class="hljs-string">[[0.02215638]</span><br><span class="hljs-string"> [0.98925725]]</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<p>模型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FC</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init</span>(<span class="hljs-params">self, in_num, out_num, lr=<span class="hljs-number">0.01</span></span>):</span><br>        self._in_num = in_num<br>        self._out_num = out_num<br>        self.w = np.random.rand(in_num, out_num)  <span class="hljs-comment"># 生成out行，in列矩阵</span><br><br>        self.b = np.zeros(out_num)<br>        self.lr = lr<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_sigmoid</span>(<span class="hljs-params">self, in_data</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + np.exp(-in_data))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, in_data</span>):</span><br>        self.z = np.dot(in_data, self.w, ) + self.b<br>        self.top_val = self._sigmoid(self.z)<br>        self.bottom_val = in_data<br>        <span class="hljs-keyword">return</span> self.top_val<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">backward</span>(<span class="hljs-params">self, loss</span>):</span><br>        residual_z = loss * self.top_val * (<span class="hljs-number">1</span> - self.top_val)<br><br>        grad_w = np.dot(self.bottom_val.T, residual_z)<br>        grad_b = np.<span class="hljs-built_in">sum</span>(residual_z)<br><br>        self.w -= self.lr * grad_w<br>        self.b -= self.lr * grad_b<br>        residual_x = np.dot(residual_z,self.w.T)<br>        <span class="hljs-keyword">return</span> residual_x<br>        <br>        <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, input_num=<span class="hljs-number">2</span>, hidden_num=<span class="hljs-number">4</span>, out_num=<span class="hljs-number">1</span>, lr=<span class="hljs-number">0.05</span></span>):</span><br>        self.fc1 = FC()<br>        self.fc1.init(input_num, hidden_num, lr) <span class="hljs-number">2</span>-<span class="hljs-number">4</span><br>        self.fc2 = FC()<br>        self.fc2.init(hidden_num, out_num, lr)  <span class="hljs-number">4</span>-<span class="hljs-number">1</span><br>        self.loss = Loss()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trian</span>(<span class="hljs-params">self, x, y</span>):</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>): <br>            layer1out = self.fc1.forward(x)<span class="hljs-comment">#2-4 1 12</span><br>            layer2out = self.fc2.forward(layer1out)<span class="hljs-comment">#4-1 </span><br>            loss = self.loss.forward(y, layer2out)<br>            delta2 = self.loss.backward()<br>            delta1 = self.fc2.backward(delta2)  <span class="hljs-number">17</span> <br>            saliency = self.fc1.backward(delta1)<br>        layer1out = self.fc1.forward(X)<br>        layer2out = self.fc2.forward(layer1out)<br>        <span class="hljs-built_in">print</span>(X)<br>        <span class="hljs-built_in">print</span>(y)<br>        <span class="hljs-built_in">print</span>(layer2out)<br><br>net=Net()<br>net.__init__(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0.1</span>)<br>net.trian(X,y)<br></code></pre></td></tr></table></figure>
<h1 id="大作业：疾病预测"><a href="#大作业：疾病预测" class="headerlink" title="大作业：疾病预测"></a>大作业：疾病预测</h1><h2 id="使用欠采样处理正负样本不能不均衡（0-816）"><a href="#使用欠采样处理正负样本不能不均衡（0-816）" class="headerlink" title="使用欠采样处理正负样本不能不均衡（0.816）"></a>使用欠采样处理正负样本不能不均衡（0.816）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 直接导入之前已经处理好的数据</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> re<br>mydata=pd.read_csv(<span class="hljs-string">&#x27;/home/mw/input/MLearn9130/训练营.csv&#x27;</span>)<br>mytest=pd.read_csv(<span class="hljs-string">&#x27;/home/mw/input/MLearn9130/测试集.csv&#x27;</span>)<br><span class="hljs-comment">## 分离训练集和验证集</span><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><br><span class="hljs-comment">## 原始列名列表</span><br>col_names=<span class="hljs-built_in">list</span>(mydata.columns)<br>col=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(col_names)):<br>    <span class="hljs-keyword">if</span> re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names[i])!=[]:<br>        col.append(re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">elif</span> re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names[i])!=[]:<br>        col.append(re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">else</span>:<br>        col.append(col_names[i])<br><br>col_names1=<span class="hljs-built_in">list</span>(mytest.columns)<br>col1=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(col_names1)):<br>    <span class="hljs-keyword">if</span> re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names1[i])!=[]:<br>        col1.append(re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names1[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">elif</span> re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names1[i])!=[]:<br>        col1.append(re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names1[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">else</span>:<br>        col1.append(col_names1[i])<br><br><span class="hljs-comment">## 修改dataframe列名</span><br>mydata.columns=col<br>mytest.columns=col1<br><br><br><span class="hljs-comment">## 对性别进行编码</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gender</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;M&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><br><span class="hljs-comment">## 对区域进行编码</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">district</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;east&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> x==<span class="hljs-string">&#x27;south&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br>    <span class="hljs-keyword">elif</span> x==<span class="hljs-string">&#x27;north&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">4</span><br><br><span class="hljs-comment">## 对护理来源进行编码</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">care</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;Governament Hospital&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;Never Counsulted&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;Private Hospital&#x27;</span> <span class="hljs-keyword">or</span> x==<span class="hljs-string">&#x27; &#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;clinic&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">4</span><br>        <br>mydata[<span class="hljs-string">&#x27;性别&#x27;</span>]=mydata[<span class="hljs-string">&#x27;性别&#x27;</span>].apply(gender)<br>mydata[<span class="hljs-string">&#x27;区域&#x27;</span>]=mydata[<span class="hljs-string">&#x27;区域&#x27;</span>].apply(district)<br>mydata[<span class="hljs-string">&#x27;护理来源&#x27;</span>]=mydata[<span class="hljs-string">&#x27;护理来源&#x27;</span>].apply(care)<br><br>mytest[<span class="hljs-string">&#x27;性别&#x27;</span>]=mytest[<span class="hljs-string">&#x27;性别&#x27;</span>].apply(gender)<br>mytest[<span class="hljs-string">&#x27;区域&#x27;</span>]=mytest[<span class="hljs-string">&#x27;区域&#x27;</span>].apply(district)<br>mytest[<span class="hljs-string">&#x27;护理来源&#x27;</span>]=mytest[<span class="hljs-string">&#x27;护理来源&#x27;</span>].apply(care)<br><br><br><span class="hljs-comment">## 对于数值型变量的缺失值用中位数进行填充</span><br>feature1 = [<span class="hljs-string">&#x27;最低血压&#x27;</span>,<span class="hljs-string">&#x27;腰围&#x27;</span>,<span class="hljs-string">&#x27;最高血压&#x27;</span>,<span class="hljs-string">&#x27;体重指数&#x27;</span>,<span class="hljs-string">&#x27;肥胖腰围&#x27;</span>,<span class="hljs-string">&#x27;身高&#x27;</span>,<span class="hljs-string">&#x27;体重&#x27;</span>,<span class="hljs-string">&#x27;好胆固醇&#x27;</span>,<span class="hljs-string">&#x27;总胆固醇&#x27;</span>,<span class="hljs-string">&#x27;坏胆固醇&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> feature1:<br>    mydata[i] = mydata[i].fillna(mydata[i].median())<br>    mytest[i] = mytest[i].fillna(mytest[i].median())<br><span class="hljs-comment">## 对于分类型变量的缺失值用众数进行填充</span><br>feature2 = [<span class="hljs-string">&#x27;收入&#x27;</span>,<span class="hljs-string">&#x27;未婚&#x27;</span>,<span class="hljs-string">&#x27;视力不佳&#x27;</span>,<span class="hljs-string">&#x27;高血压&#x27;</span>,<span class="hljs-string">&#x27;慢性疲劳&#x27;</span>,<span class="hljs-string">&#x27;肝炎&#x27;</span>,<span class="hljs-string">&#x27;教育&#x27;</span>,<span class="hljs-string">&#x27;糖尿病&#x27;</span>,<span class="hljs-string">&#x27;家族肝炎&#x27;</span>,<span class="hljs-string">&#x27;体育活动&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> feature2:<br>    mydata[i] = mydata[i].fillna(mydata[i].mode()[<span class="hljs-number">0</span>])<br>    mytest[i] = mytest[i].fillna(mytest[i].mode()[<span class="hljs-number">0</span>])<br>    <br>    <br>cut = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(mydata[<span class="hljs-string">&#x27;ALF&#x27;</span>])):<br>    <span class="hljs-keyword">if</span> mydata[<span class="hljs-string">&#x27;ALF&#x27;</span>][i] == <span class="hljs-number">0</span>:<br>        r = random.random()<br>        <span class="hljs-keyword">if</span> r &gt; <span class="hljs-number">0.1</span>:<br>            cut.append(i)<br>mydata = mydata.drop(cut)<br><br><br><br><span class="hljs-comment">## 导入需要的库</span><br><span class="hljs-keyword">import</span> xgboost <span class="hljs-keyword">as</span> xgb<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> datasets<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br>X = mydata.drop([<span class="hljs-string">&#x27;ALF&#x27;</span>,<span class="hljs-string">&quot;id&quot;</span>], axis=<span class="hljs-number">1</span>) <br><span class="hljs-comment"># X = mydata.drop([&#x27;ALF&#x27;], axis=1) </span><br>y = mydata[<span class="hljs-string">&#x27;ALF&#x27;</span>] <br>X_train, X_val, y_train, y_val = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, stratify=y)<br><br><br><span class="hljs-keyword">import</span> lightgbm <span class="hljs-keyword">as</span> lgb<br><br>clf7 = lgb.LGBMClassifier(<br>    max_depth=<span class="hljs-number">3</span>,<br>    n_estimators=<span class="hljs-number">2000</span>,<br>    n_jobs=-<span class="hljs-number">1</span>,<br>    verbose=-<span class="hljs-number">1</span>,<br>    learning_rate=<span class="hljs-number">0.1</span>,<br>)<br>clf7.fit(X_train, y_train, eval_set=[(X_val,y_val)], callbacks=[lgb.early_stopping(<span class="hljs-number">50</span>)])<br>val_y_predict = clf7.predict(X_val)<br><br>roc_auc_score(y_val, val_y_predict) <span class="hljs-comment">#使用sklearn进行比较正确率</span><br><br><br>mytest[<span class="hljs-string">&#x27;ALF&#x27;</span>]=<span class="hljs-number">0</span><br>X_test = mytest.drop([<span class="hljs-string">&#x27;ALF&#x27;</span>,<span class="hljs-string">&quot;id&quot;</span>], axis=<span class="hljs-number">1</span>) <br>y_test= mytest[<span class="hljs-string">&#x27;ALF&#x27;</span>] <br>val_preds = clf7.predict(X_test)<br>result_list = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(val_preds)):<br>    userid = mytest[<span class="hljs-string">&#x27;id&#x27;</span>][i]<br>    ALF = val_preds[i]<br>    line=[userid,ALF]<br>    result_list.append(line)<br><span class="hljs-built_in">print</span>(result_list[:<span class="hljs-number">20</span>])<br>df = pd.DataFrame(result_list, columns=[<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-string">&#x27;ALF&#x27;</span>])<br>df.to_csv(<span class="hljs-string">&#x27;0721-1329.csv&#x27;</span>, index=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/07/21/v3JhKGwuZT45QCi.png" srcset="/img/loading.gif" lazyload alt="image-20220721134700727" style="zoom: 80%;" /></p>
<h2 id="使用欠采样、模拟voting（0-834）"><a href="#使用欠采样、模拟voting（0-834）" class="headerlink" title="使用欠采样、模拟voting（0.834）"></a>使用欠采样、模拟voting（0.834）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 直接导入之前已经处理好的数据</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> re<br>mydata=pd.read_csv(<span class="hljs-string">&#x27;/home/mw/input/MLearn9130/训练营.csv&#x27;</span>)<br>mytest=pd.read_csv(<span class="hljs-string">&#x27;/home/mw/input/MLearn9130/测试集.csv&#x27;</span>)<br><span class="hljs-comment">## 分离训练集和验证集</span><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><br><span class="hljs-comment">## 原始列名列表</span><br>col_names=<span class="hljs-built_in">list</span>(mydata.columns)<br>col=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(col_names)):<br>    <span class="hljs-keyword">if</span> re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names[i])!=[]:<br>        col.append(re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">elif</span> re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names[i])!=[]:<br>        col.append(re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">else</span>:<br>        col.append(col_names[i])<br><br>col_names1=<span class="hljs-built_in">list</span>(mytest.columns)<br>col1=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(col_names1)):<br>    <span class="hljs-keyword">if</span> re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names1[i])!=[]:<br>        col1.append(re.findall(<span class="hljs-string">r&quot;\u2028(.+)&quot;</span>,col_names1[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">elif</span> re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names1[i])!=[]:<br>        col1.append(re.findall(<span class="hljs-string">r&quot;\n(.+)&quot;</span>,col_names1[i])[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">else</span>:<br>        col1.append(col_names1[i])<br><br><span class="hljs-comment">## 修改dataframe列名</span><br>mydata.columns=col<br>mytest.columns=col1<br><br><br><span class="hljs-comment">## 对性别进行编码</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gender</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;M&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><br><span class="hljs-comment">## 对区域进行编码</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">district</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;east&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> x==<span class="hljs-string">&#x27;south&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br>    <span class="hljs-keyword">elif</span> x==<span class="hljs-string">&#x27;north&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">4</span><br><br><span class="hljs-comment">## 对护理来源进行编码</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">care</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;Governament Hospital&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;Never Counsulted&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;Private Hospital&#x27;</span> <span class="hljs-keyword">or</span> x==<span class="hljs-string">&#x27; &#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span><br>    <span class="hljs-keyword">if</span> x==<span class="hljs-string">&#x27;clinic&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">4</span><br>        <br>mydata[<span class="hljs-string">&#x27;性别&#x27;</span>]=mydata[<span class="hljs-string">&#x27;性别&#x27;</span>].apply(gender)<br>mydata[<span class="hljs-string">&#x27;区域&#x27;</span>]=mydata[<span class="hljs-string">&#x27;区域&#x27;</span>].apply(district)<br>mydata[<span class="hljs-string">&#x27;护理来源&#x27;</span>]=mydata[<span class="hljs-string">&#x27;护理来源&#x27;</span>].apply(care)<br><br>mytest[<span class="hljs-string">&#x27;性别&#x27;</span>]=mytest[<span class="hljs-string">&#x27;性别&#x27;</span>].apply(gender)<br>mytest[<span class="hljs-string">&#x27;区域&#x27;</span>]=mytest[<span class="hljs-string">&#x27;区域&#x27;</span>].apply(district)<br>mytest[<span class="hljs-string">&#x27;护理来源&#x27;</span>]=mytest[<span class="hljs-string">&#x27;护理来源&#x27;</span>].apply(care)<br><br><br><span class="hljs-comment">## 对于数值型变量的缺失值用中位数进行填充</span><br>feature1 = [<span class="hljs-string">&#x27;最低血压&#x27;</span>,<span class="hljs-string">&#x27;腰围&#x27;</span>,<span class="hljs-string">&#x27;最高血压&#x27;</span>,<span class="hljs-string">&#x27;体重指数&#x27;</span>,<span class="hljs-string">&#x27;肥胖腰围&#x27;</span>,<span class="hljs-string">&#x27;身高&#x27;</span>,<span class="hljs-string">&#x27;体重&#x27;</span>,<span class="hljs-string">&#x27;好胆固醇&#x27;</span>,<span class="hljs-string">&#x27;总胆固醇&#x27;</span>,<span class="hljs-string">&#x27;坏胆固醇&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> feature1:<br>    mydata[i] = mydata[i].fillna(mydata[i].median())<br>    mytest[i] = mytest[i].fillna(mytest[i].median())<br><span class="hljs-comment">## 对于分类型变量的缺失值用众数进行填充</span><br>feature2 = [<span class="hljs-string">&#x27;收入&#x27;</span>,<span class="hljs-string">&#x27;未婚&#x27;</span>,<span class="hljs-string">&#x27;视力不佳&#x27;</span>,<span class="hljs-string">&#x27;高血压&#x27;</span>,<span class="hljs-string">&#x27;慢性疲劳&#x27;</span>,<span class="hljs-string">&#x27;肝炎&#x27;</span>,<span class="hljs-string">&#x27;教育&#x27;</span>,<span class="hljs-string">&#x27;糖尿病&#x27;</span>,<span class="hljs-string">&#x27;家族肝炎&#x27;</span>,<span class="hljs-string">&#x27;体育活动&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> feature2:<br>    mydata[i] = mydata[i].fillna(mydata[i].mode()[<span class="hljs-number">0</span>])<br>    mytest[i] = mytest[i].fillna(mytest[i].mode()[<span class="hljs-number">0</span>])<br>    <br>    <br><span class="hljs-keyword">import</span> random<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;111&quot;</span>, <span class="hljs-built_in">len</span>(mydata[mydata[<span class="hljs-string">&#x27;ALF&#x27;</span>] == <span class="hljs-number">0.0</span>]))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;111&quot;</span>, <span class="hljs-built_in">len</span>(mydata[mydata[<span class="hljs-string">&#x27;ALF&#x27;</span>] == <span class="hljs-number">1.0</span>]))<br>mydata_list = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>cnt = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(mydata)):<br>    <span class="hljs-keyword">if</span> mydata[<span class="hljs-string">&#x27;ALF&#x27;</span>][i] == <span class="hljs-number">0</span>:<br>        mydata_list[cnt%<span class="hljs-number">10</span>].append(mydata.iloc[i].tolist())<br>        cnt += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>            mydata_list[j].append(mydata.iloc[i].tolist())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    mydata_list[i] = pd.DataFrame(mydata_list[i], columns = <span class="hljs-built_in">list</span>(mydata.columns))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(mydata_list[i]))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">111 3880</span><br><span class="hljs-string">111 320</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">708</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><br><span class="hljs-comment">## 导入需要的库</span><br><span class="hljs-keyword">import</span> xgboost <span class="hljs-keyword">as</span> xgb<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> lightgbm <span class="hljs-keyword">as</span> lgb<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> roc_auc_score<br>score = []<br>clf_list = []<br><span class="hljs-keyword">for</span> part_data <span class="hljs-keyword">in</span> mydata_list:<br>    X = part_data.drop([<span class="hljs-string">&#x27;ALF&#x27;</span>,<span class="hljs-string">&quot;id&quot;</span>], axis=<span class="hljs-number">1</span>) <br>    y = part_data[<span class="hljs-string">&#x27;ALF&#x27;</span>] <br>    X_train, X_val, y_train, y_val = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, stratify=y)<br><br>    clf = lgb.LGBMClassifier(<br>        max_depth=<span class="hljs-number">3</span>,<br>        n_estimators=<span class="hljs-number">2000</span>,<br>        n_jobs=-<span class="hljs-number">1</span>,<br>        verbose=-<span class="hljs-number">1</span>,<br>        learning_rate=<span class="hljs-number">0.15</span><br>    )<br>    clf.fit(X_train, y_train, eval_set=[(X_val,y_val)], callbacks=[lgb.early_stopping(<span class="hljs-number">20</span>)])<br><br>    <br>    val_y_predict = clf.predict(X_val)<br><br>    this_score = roc_auc_score(y_val, val_y_predict)<br>    <span class="hljs-built_in">print</span>(this_score)<br>    score.append(this_score) <span class="hljs-comment">#使用sklearn进行比较正确率</span><br>    clf_list.append(clf)<br><br>    <br>score<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[0.7685630341880343,</span><br><span class="hljs-string"> 0.7553418803418803,</span><br><span class="hljs-string"> 0.8179754273504273,</span><br><span class="hljs-string"> 0.813167735042735,</span><br><span class="hljs-string"> 0.8202457264957264,</span><br><span class="hljs-string"> 0.7728365384615385,</span><br><span class="hljs-string"> 0.7799145299145299,</span><br><span class="hljs-string"> 0.8051549145299145,</span><br><span class="hljs-string"> 0.8050213675213675,</span><br><span class="hljs-string"> 0.8012820512820513]</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>score_edit = [ i/<span class="hljs-built_in">sum</span>(score) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> score]<br>score_edit<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[0.0968024087063296,</span><br><span class="hljs-string"> 0.09513717178853173,</span><br><span class="hljs-string"> 0.10302602142941246,</span><br><span class="hljs-string"> 0.10242048073203143,</span><br><span class="hljs-string"> 0.10331197120317571,</span><br><span class="hljs-string"> 0.09734066710400163,</span><br><span class="hljs-string"> 0.09823215757514593,</span><br><span class="hljs-string"> 0.10141124623639637,</span><br><span class="hljs-string"> 0.10139442566146913,</span><br><span class="hljs-string"> 0.1009234495635061]</span><br><span class="hljs-string"> &quot;&quot;&quot;</span><br><br>mytest[<span class="hljs-string">&#x27;ALF&#x27;</span>]=<span class="hljs-number">0</span><br>X_test = mytest.drop([<span class="hljs-string">&#x27;ALF&#x27;</span>,<span class="hljs-string">&quot;id&quot;</span>], axis=<span class="hljs-number">1</span>) <br>y_test= mytest[<span class="hljs-string">&#x27;ALF&#x27;</span>]<br><br>val_preds = pd.DataFrame()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    val_preds[<span class="hljs-string">&#x27;clf&#x27;</span>+<span class="hljs-built_in">str</span>(i)] = clf_list[i].predict(X_test)<br><br>val_preds[<span class="hljs-string">&#x27;final&#x27;</span>] = <span class="hljs-built_in">sum</span>([ val_preds[i]*score_edit[<span class="hljs-built_in">int</span>(i[-<span class="hljs-number">1</span>])] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(val_preds.columns)[:<span class="hljs-number">10</span>]])<br><br>val_preds.to_csv(<span class="hljs-string">&#x27;look.csv&#x27;</span>, index=<span class="hljs-literal">False</span>)<br>val_preds<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">输出格式见下方</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>result_list = []<br>val_preds_final = val_preds[<span class="hljs-string">&#x27;final&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(val_preds)):<br>    userid = mytest[<span class="hljs-string">&#x27;id&#x27;</span>][i]<br>    <span class="hljs-comment"># ALF = val_preds[&#x27;clf3&#x27;][i]</span><br>    <span class="hljs-comment"># ALF = 1.0 if val_preds_final[i] else 0.0</span><br>    ALF = <span class="hljs-number">1.0</span> <span class="hljs-keyword">if</span> val_preds_final[i]&gt;<span class="hljs-number">0.52</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span><br>    line=[userid,ALF]<br>    result_list.append(line)<br><span class="hljs-built_in">print</span>(result_list[:<span class="hljs-number">20</span>])<br>df = pd.DataFrame(result_list, columns=[<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-string">&#x27;ALF&#x27;</span>])<br>df.to_csv(<span class="hljs-string">&#x27;0721-2029.csv&#x27;</span>, index=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/07/21/A5LQj8CouqzcDMd.png" srcset="/img/loading.gif" lazyload alt="image-20220721203754220" style="zoom:67%;" /></p>
<p><img src="https://s2.loli.net/2022/07/21/JjfUecxAlYaG5tV.png" srcset="/img/loading.gif" lazyload alt="image-20220721203450235" style="zoom: 80%;" /></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E8%AF%BE%E5%A4%96%E5%AD%A6%E4%B9%A0/">课外学习</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/07/22/heywhale-summer-camp-ds/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">和鲸社区2022咸鱼打挺夏令营-数据结构·闯关-作业答案</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/07/15/30days-of-ml-202207-nlp/">
                        <span class="hidden-mobile">汽车领域多语种迁移学习挑战赛 - Coggle 30 Days of ML（22年7月）</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="twikoo"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/twikoo@1/dist/twikoo.all.min.js', function() {
        var options = Object.assign(
          {"envId":"https://blog-comment-h866w5ycd-junyaohu.vercel.app/","region":"ap-shanghai","path":"window.location.pathname"},
          {
            el: '#twikoo',
            path: 'window.location.pathname',
            onCommentLoaded: function() {
              Fluid.plugins.initFancyBox('#twikoo .tk-content img:not(.tk-owo-emotion)');
            }
          }
        )
        twikoo.init(options)
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  








  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?17340920";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
